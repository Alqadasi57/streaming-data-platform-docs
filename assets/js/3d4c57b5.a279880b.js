"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8175],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),m=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=m(e.components);return n.createElement(l.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=m(a),u=i,h=d["".concat(l,".").concat(u)]||d[u]||p[u]||r;return a?n.createElement(h,s(s({ref:t},c),{},{components:a})):n.createElement(h,s({ref:t},c))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,s=new Array(r);s[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[d]="string"==typeof e?e:i,s[1]=o;for(var m=2;m<r;m++)s[m]=a[m];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},53816:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>m});var n=a(87462),i=(a(67294),a(3905));const r={sidebar_position:2},s="Messages",o={unversionedId:"cloud/s3/messages",id:"cloud/s3/messages",title:"Messages",description:"Messages are the files encoded in protobuf data schema and compressed using",source:"@site/docs/cloud/s3/messages.md",sourceDirName:"cloud/s3",slug:"/cloud/s3/messages",permalink:"/docs/cloud/s3/messages",draft:!1,editUrl:"https://github.com/bitquery/streaming-data-platform-docs/tree/main/docs/cloud/s3/messages.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Buckets",permalink:"/docs/cloud/s3/buckets"},next:{title:"Demo Buckets",permalink:"/docs/cloud/s3/demo"}},l={},m=[],c={toc:m},d="wrapper";function p(e){let{components:t,...r}=e;return(0,i.kt)(d,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"messages"},"Messages"),(0,i.kt)("p",null,"Messages are the files encoded in protobuf data schema and compressed using\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/lz4/lz4"},"lz4")," utility."),(0,i.kt)("p",null,"So the file has extention of ",(0,i.kt)("inlineCode",{parentName:"p"},".lz4"),".Before decoding with protobuf, you have to de-compress it\nusing ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/lz4/lz4"},"lz4"),"."),(0,i.kt)("p",null,"Messages are grouped into folders by 1000 blockchain blocks each. The name of the blocks folder\nis padded with vertain number of '0-s', that enable you to sort blocks using S3 search functions."),(0,i.kt)("h1",{id:"naming"},"Naming"),(0,i.kt)("p",null,"Example of the full path to the message is ",(0,i.kt)("inlineCode",{parentName:"p"},"eth.dextrades.s3/000001881000/000001881143_0x6076a99f05633913f4746a0b64fbf516c96f528107ba9d10c28919ecbbb50133_d0687720be3358b36f07209d080c3b9600f2ee4300f5abd16e74a4bf539c53d6.block.lz4")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"eth.dextrades.s3")," is the name of the ",(0,i.kt)("a",{parentName:"li",href:"/docs/cloud/s3/buckets"},"bucket")," containing EVM DEX trade messages"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"000001881000")," contains messages for blocks between 1881000 and 1881999"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"000001881143")," is the number of the block"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"0x6076a99f05633913f4746a0b64fbf516c96f528107ba9d10c28919ecbbb50133")," is the block hash"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"d0687720be3358b36f07209d080c3b9600f2ee4300f5abd16e74a4bf539c53d6")," is the message body hash"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"block.lz4")," is file extention meaning it is block of data with ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/lz4/lz4"},"lz4")," compression")),(0,i.kt)("h1",{id:"identity"},"Identity"),(0,i.kt)("p",null,"Message object in S3 is naturally identified by the full path. It includes blockchain-related attributes, as\nblock hash and block number (or height)."),(0,i.kt)("p",null,"Message content is identified by the message body hash, also included in the S3 path.\nAs many nodes can write to the same stream, the messages may contain several messages for the same blockchain block\nwith different body hash."),(0,i.kt)("h1",{id:"metadata"},"Metadata"),(0,i.kt)("p",null,"Message object in S3 has several specific ",(0,i.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingMetadata.html"},"metadata")," attributes, added to every message:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"AWS S3 metadata",src:a(18468).Z,width:"2710",height:"1322"})),(0,i.kt)("p",null,"There are atttributes common for all messages:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x-amz-meta-auth-body-hash")," message body hash. Hash calculated with keccak-256 algorith, with 32 first bytes used."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x-amz-meta-auth-timestamp")," message timestamp in nanosecond UNIx timestamp"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x-amz-meta-auth-message-id")," message unique identifier"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x-amz-meta-auth-signature")," message signature"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x-amz-meta-auth-signer")," signer of the message"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x-amz-meta-size")," size of the body (uncompressed)")),(0,i.kt)("p",null,"There are specific attributes for the blockchain (depending on schema):"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x-amz-meta-descriptor-chain-id")," ",(0,i.kt)("a",{parentName:"li",href:"/docs/graphql/dataset/network"},"blockchain identifier")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x-amz-meta-descriptor-block-hash")," block hash"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x-amz-meta-descriptor-parent-hash")," block parent hash"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x-amz-meta-descriptor-block-number")," block number (height)")),(0,i.kt)("p",null,"There are specific attributes for the type of message (depending on schema):"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"x-amz-meta-descriptor-trades-count")," dex trade count inside the message")),(0,i.kt)("h1",{id:"signature"},"Signature"),(0,i.kt)("p",null,"Message identifier is generated as a concatenation of:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"message body hash"),(0,i.kt)("li",{parentName:"ul"},"timestamp"),(0,i.kt)("li",{parentName:"ul"},"descriptor of message, json serialized (not included in S3 metadata)")),(0,i.kt)("p",null,"It is signed with ECDSA private key of the node owner. "),(0,i.kt)("p",null,"Message metadata attribute ",(0,i.kt)("inlineCode",{parentName:"p"},"x-amz-meta-auth-signer")," shows the owner of the node, which\ngenerated the message. Message can be validated with ",(0,i.kt)("inlineCode",{parentName:"p"},"x-amz-meta-auth-signature")," attribute."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"As descriptor is not a part of the message metadata, you can not validate the signature against the body content.")))}p.isMDXComponent=!0},18468:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/metadata-52918d9b96c7627e6bc3a991ee3ec871.png"}}]);